# 桌面龙虾优化日志

## 2026-02-07 优化记录

### ✅ 第一阶段:核心体验优化 (已完成)

#### 1. 进度语音播报 🔊
**问题:** 执行任务时没有中间反馈,不知道进行到哪步
**解决方案:**
- 创建通用工具 `progress-notify.js`
- 修改 `lark-screenshot.js` 添加每步播报
- 每步间隔800ms,避免语音太快

**效果:**
```
🔊 "正在截图"
🔊 "截图完成"
🔊 "正在上传到飞书"
🔊 "上传成功"
🔊 "正在发送"
🔊 "截图已发送!"
```

#### 2. 截图按钮 📸
**位置:** 菜单 - 替换了"充能"按钮
**功能:** 点击直接截图并发送到飞书
**反馈:** 动画 + 气泡提示

#### 3. Windows 系统通知 🔔
**触发条件:** 窗口未聚焦时收到新消息
**内容:** 显示发送者和消息内容(最多100字符)
**图标:** 使用桌面龙虾图标

#### 4. 语音开关修复 🔊
**问题:** 按钮只改变UI,不真正控制语音
**解决方案:**
- 添加IPC处理 `set-voice-enabled`
- 修改 `working-voice.js` 添加 `enabled` 属性
- speak() 函数检查 enabled 状态
- 配置持久化到 `pet-config.json`

---

### 📋 第二阶段:待实现功能

#### 5. 消息历史记录 📜 (下一步)
**需求:**
- 可折叠的消息列表面板
- 显示用户/AI消息(区分颜色)
- 支持滚动查看
- 保存最近50条
- 右键复制消息

**设计:**
```
┌─────────────────┐
│ 🦞 Claw         │
│ [消息历史 ▼]    │
├─────────────────┤
│ 用户: 你好      │ (蓝色气泡,右对齐)
│ AI: 你好!      │ (紫色气泡,左对齐)
│ ...             │
└─────────────────┘
```

#### 6. 快捷键支持 ⌨️
- Ctrl+Shift+C: 显示/隐藏
- Ctrl+Shift+S: 截图
- Ctrl+Shift+M: 静音切换
- Ctrl+Shift+V: 语音切换

#### 7. 连接状态详情 🔌
鼠标悬停状态灯时显示:
```
OpenClaw Gateway: ✅ 已连接
语音系统: ✅ 正常
消息同步: ✅ 运行中
最后活动: 2秒前
```

---

### 🎨 第三阶段:锦上添花

#### 8. 主题切换
- 深色/浅色模式
- 自定义配色
- 不同龙虾皮肤

#### 9. 插件系统
- 天气小组件
- 日历提醒
- 待办事项

#### 10. 性能监控
- 消息处理延迟
- 语音播放时长
- 截图上传速度

---

## 技术债务

### 需要重构的部分:
- [ ] 消息存储逻辑(当前只显示,不存储)
- [ ] 语音队列管理(避免重叠)
- [ ] 配置管理统一化

### 已知问题:
- [ ] 长文本气泡可能超出屏幕
- [ ] 快速切换状态时动画可能重叠
- [ ] 托盘菜单项过多,需要分类

---

## 下次优化计划

### 优先级排序:
1. 🔥 消息历史记录 (最重要)
2. ⌨️ 快捷键支持 (提升效率)
3. 🔌 连接状态详情 (调试友好)
4. 🎨 UI细节优化
5. 📊 性能优化

### 预计时间:
- 消息历史: 2-3小时
- 快捷键: 1小时
- 状态详情: 30分钟
- 总计: 4小时左右

---

**当前版本:** v1.3.0  
**上次更新:** 2026-02-07 03:30
